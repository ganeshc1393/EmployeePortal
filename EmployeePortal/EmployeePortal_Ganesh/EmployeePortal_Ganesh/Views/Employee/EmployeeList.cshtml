@model EmployeePortal_Ganesh.Models.EmployeeDetails
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Employee Search List Screen";
}
<h2 style="text-align:center;font-weight:bold" class="form-control">@ViewBag.Title</h2>
@if (ViewBag.alert == "False")
{
    <h2 style="text-align:center;font-weight:bold; color:red" class="form-control alert_tag">@ViewBag.alert_message</h2>
}
else if (ViewBag.alert == "True")
{
    <h2 style="text-align:center;font-weight:bold; color:green" class="form-control alert_tag">@ViewBag.alert_message</h2>
}
<h2 style="text-align:center;font-weight:bold; color:red;" class="form-control alert_tag" id="dt_alertmesage"></h2>
@using (Html.BeginForm("CreatEmployee", "Employee", FormMethod.Post, new { @id = "frmEmployeeList" }))
{
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div id="sticky-anchor"></div>
            <div class="portlet-body form">
                <div class="form-horizontal">
                    <div class="form-body">
                        <div class="row">
                            <div class="col-lg-6 col-md-10 col-sm-10 col-xs-12 text-right">
                                <div class="form-group">
                                    <label class="col-lg-4 col-md-4 col-sm-5 col-xs-5">
                                        Emp No# <span style="color: red;"> </span>
                                    </label>
                                    <div class="col-lg-8 col-md-8 col-sm-7 col-xs-7">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(m => m.emp_no, new { @class = "form-control", @maxlength = "5" })
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6 col-md-10 col-sm-10 col-xs-12 text-right">
                                <div class="form-group">
                                    <label class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                        Emp name <span style="color: red;"> </span>
                                    </label>
                                    <div class="col-ls-8 col-md-8 col-sm-8 col-xs-8">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(m => m.emp_name, new { @class = "form-control", @maxlength = "5" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-10 col-sm-10 col-xs-12 text-right">
                                <div class="form-group">
                                    <label class="col-lg-4 col-md-4 col-sm-5 col-xs-5">
                                        Gender <span style="color: red;"> </span>
                                    </label>
                                    <div class="col-lg-8 col-md-8 col-sm-7 col-xs-7">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.DropDownListFor(x => x.gender, new List<SelectListItem>
                                            {
                                                new SelectListItem() {Text = "Male", Value="M"},
                                                new SelectListItem() {Text = "Female", Value="F"},
                                                new SelectListItem() {Text = "ND", Value="ND"}
                                            }, "Select", new { @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-10 col-sm-10 col-xs-12 text-right">
                                <div class="form-group">
                                    <label class="col-lg-4 col-md-4 col-sm-5 col-xs-5">
                                        <span style="color: red;"></span>
                                    </label>
                                    <div class="col-lg-6 col-md-8 col-sm-7 col-xs-7">
                                        <div class="input-icon right" style="text-align:left">
                                            <i class="fa"></i>
                                            <button type="button" class="btn btn-default" id="btnSearch">Search</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <div id="sticky-anchor"></div>
            <div id="dvHeader" class="portlet box green">
                <div class="tools">
                    <button type="button" class="btn btn-default" id="btnAddEmployee">Add new employee</button>
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align:right">
            <div id="sticky-anchor"></div>
            <div id="dvHeader" class="portlet box green">
                <div class="tools">
                    <button type="button" class="btn btn-default" id="btnDownload">CSV Download</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="container">
                <br />
                <div style="width:90%; margin:0 auto;">
                    <table id="example" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Contact</th>
                                <th>Level & Post</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts{

    <script src="~/Scripts/jquery-1.12.4.js"></script>
    <script src="~/Scripts/DataTables/jquery.dataTables.js"></script>
    <link href="~/Content/DataTables/css/jquery.dataTables.css" rel="stylesheet" />
    <script type="text/javascript">
    $(document).ready(function () {
        fnbind_grid();
        $("#dt_alertmesage").hide();
    });
    $("#btnAddEmployee").click(function () {
        window.location.href="@Url.Action("CreatEmployee", "Employee")";
    });
        $("#btnSearch").click(function () {
            $(".alert_tag").hide();
            fnbind_grid_bysearch();
        });
        $("#btnDownload").click(function () {

            fnDownload();
        });
    </script>

    <script type="text/javascript">
        function fnbind_grid() {
            $.ajax({
                type: "POST",
                url: "/Employee/GetAllEmployeeList",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    OnSuccess(response);
                },
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });
        }
        function fnbind_grid_bysearch() {
            var emp_no = $("#emp_no").val();
            var emp_name = $("#emp_name").val();
            var gender = $("#gender").val();
            $.ajax({
                type: "POST",
                url: "/Employee/GetEmployeeListBySearch?emp_no=" + emp_no + "&emp_name=" + emp_name + "&gender=" + gender,
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    OnSuccess(response);
                    if (!$.trim(response)) {
                        $("#dt_alertmesage").show();
                        $("#dt_alertmesage").html("Sorry, employee record could not be found!!");
                    }
                },
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });
        }
        function OnSuccess(response) {
            var provTable = $("#example").DataTable(
                {
                    destroy: true,
                    aaData: response.data,
                    bLengthChange: true,
                    lengthMenu: [[20, 50, -1], [20, 50, "All"]],
                    bFilter: false,
                    bSort: false,
                    bPaginate: true,
                    data: response,
                    columns: [
                        {
                            'data': function (data, type, dataToSet) {
                                return '<label class="label" style="text-align:center; color:blue;font-size:100%">' + data.emp_name + "</label><br/>" + '<label class="label" style="text-align:center; color:red;font-size:100%">#' + data.emp_no;
                            }
                        },
                        {
                            'data': function (data, type, dataToSet) {
                                return data.mobile_num + "/<br/>" + data.email_id;
                            }
                        },
                        {
                            'data': function (data, type, dataToSet) {
                                return data.emp_level + "/<br/>" + data.post;
                            }
                        },
                        {
                            'data': function (data, type, dataToSet) {
                                return '<a href=/EmployeeHistory/Index?id=' + data.emp_no + '&emp_name=' + data.first_name+"&nbsp;"+data.last_name +'\>Employments</a>' + "&nbsp/ " + '<a href=/Employee/Edit?id=' + data.emp_no + '\>Edit</a>' + "&nbsp/ " + '<a href=# onclick=fndelete(' + data.emp_no+') id=del>Delete</a>';
                            }
                        }]
                });
        };
        function fndelete(emp_no) {
            var con = confirm("Are you sure you want to delete this EmpNo#" + emp_no)
            if (con) {
                window.location.href = "/Employee/Delete?id=" + emp_no;
            }
        };
        function fnDownload() {
            var emp_no = $("#emp_no").val();
            var emp_name = $("#emp_name").val();
            var gender = $("#gender").val();
            _emp_no = emp_no == '' ? '' : emp_no;
            _emp_name = emp_name == '' ? '' : emp_name;
            _gender = gender == '' ? '' : gender;
            window.location.href = "/Employee/ExportToCsv?emp_no=" + _emp_no + "&emp_name=" + _emp_name + "&gender=" + _gender;
        }

    </script>
}
